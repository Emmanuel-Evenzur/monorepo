// Copyright 2018 The Bazel Authors. All rights reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//    http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

syntax = "proto3";

package remote_logging;

import "google/devtools/remoteexecution/v1test/remote_execution.proto";
import "google/longrunning/operations.proto";
import "google/watcher/v1/watch.proto";
import "google/rpc/status.proto";

option java_package = "com.google.devtools.build.lib.remote.logging";

// A single log entry for gRPC calls related to remote execution.
message LogEntry {
  // Log entry details for call
  // [Remote Execution API][google.devtools.remoteexecution.v1test.Execution.Execute]
  message ExecuteEntry {
    // [Remote Execution API][google.devtools.remoteexecution.v1test.ExecuteResponse]
    // sent by the Execute call.
    google.devtools.remoteexecution.v1test.ExecuteRequest request = 1;
    // The [google.longrunning.Operation][google.longrunning.Operation] received
    // by the Execute call.
    google.longrunning.Operation operation = 2;
  }

  // Log entry details for call [Watcher API][google.watcher.v1.Watcher.Watch].
  message WatchEntry {
    // The [Watcher API][google.watcher.v1.Request] sent by the Watch call.
    google.watcher.v1.Request request = 1;
    // A list of [Watcher API][google.watcher.v1.ChangeBatch] received (in
    // stream) by the watch call.
    repeated google.watcher.v1.ChangeBatch change_batch = 2;
  }

  // Request metadata included in call.
  google.devtools.remoteexecution.v1test.RequestMetadata metadata = 1;

  // Status of the call on close.
  google.rpc.Status status = 2;

  // Name of the method called.
  string method_name = 3;

  // Additional logged details for specific methods.
  oneof details {
    ExecuteEntry execute_entry = 4;
    WatchEntry watch_entry = 5;
  }
}