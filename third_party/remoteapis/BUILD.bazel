load("@rules_java//java:defs.bzl", "java_proto_library")
load("@rules_proto//proto:defs.bzl", "proto_library")
load("//third_party/grpc:build_defs.bzl", "java_grpc_library")
load("//tools/build_rules:utilities.bzl", "java_library_srcs")

package(default_visibility = ["//visibility:public"])

licenses(["notice"])

exports_files(["bazel_remote_apis.patch"])

filegroup(
    name = "srcs",
    srcs = glob(["**"]),
    visibility = ["@//third_party:__pkg__"],
)

JAVA_LIBRARY_PROTOS = {
    "build_bazel_semver_semver": "@bazel_remote_apis//build/bazel/semver:semver_java_proto",
    "build_bazel_remote_asset_v1_remote_asset": "@bazel_remote_apis//build/bazel/remote/asset/v1:remote_asset_java_proto",
    "build_bazel_remote_execution_v2_remote_execution": "@bazel_remote_apis//build/bazel/remote/execution/v2:remote_execution_java_proto",
}

[java_library_srcs(
    name = proto[0] + "_java_proto_srcs",
    deps = [proto[1]],
) for proto in JAVA_LIBRARY_PROTOS.items()]

# for bootstrapping
filegroup(
    name = "dist_jars",
    srcs = [":" + proto + "_java_proto_srcs" for proto in JAVA_LIBRARY_PROTOS] + [
        ":build_bazel_remote_asset_v1_remote_asset_java_grpc_srcs",
        ":build_bazel_remote_execution_v2_remote_execution_java_grpc_srcs",
    ],
    visibility = ["@//src:__pkg__"],
)

java_grpc_library(
    name = "build_bazel_remote_asset_v1_remote_asset_java_grpc",
    srcs = ["@bazel_remote_apis//build/bazel/remote/asset/v1:remote_asset_proto"],
    deps = ["@bazel_remote_apis//build/bazel/remote/asset/v1:remote_asset_java_proto"],
)

java_grpc_library(
    name = "build_bazel_remote_execution_v2_remote_execution_java_grpc",
    srcs = ["@bazel_remote_apis//build/bazel/remote/execution/v2:remote_execution_proto"],
    deps = [
        "@bazel_remote_apis//build/bazel/remote/execution/v2:remote_execution_java_proto",
        "@googleapis//:google_longrunning_operations_java_proto",
    ],
)
